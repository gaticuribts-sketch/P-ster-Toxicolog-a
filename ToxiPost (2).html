<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación Laboratorio: MDA y Proteínas (Bradford)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        science: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        bradford: {
                            100: '#dbeafe',
                            500: '#3b82f6',
                            900: '#1e3a8a', // Coomassie Blue
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'vibrate': 'vibrate 0.3s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        vibrate: {
                            '0%, 100%': { transform: 'translate(0)' },
                            '20%': { transform: 'translate(-2px, 2px)' },
                            '40%': { transform: 'translate(-2px, -2px)' },
                            '60%': { transform: 'translate(2px, 2px)' },
                            '80%': { transform: 'translate(2px, -2px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .liquid { transition: height 1s ease, background-color 2s ease; }
        .well { transition: background-color 1.5s ease; }
        
        /* Custom ranges */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #0ea5e9; margin-top: -8px; cursor: pointer; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #cbd5e1; border-radius: 2px;
        }
    </style>
</head>
<body class="text-slate-700 h-screen flex flex-col overflow-hidden selection:bg-science-100">

    <!-- Top Bar & Progress -->
    <header class="bg-white border-b border-slate-200 p-4 z-10">
        <div class="max-w-5xl mx-auto">
            <div class="flex justify-between items-center mb-2">
                <h1 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Protocolo Experimental v2.1</h1>
                <span id="step-counter" class="text-science-600 font-bold text-sm">Inicio</span>
            </div>
            <div class="w-full bg-slate-100 rounded-full h-2">
                <div id="progress-bar" class="bg-science-500 h-2 rounded-full transition-all duration-500 shadow-[0_0_10px_rgba(14,165,233,0.5)]" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 flex items-center justify-center p-4 relative overflow-y-auto">
        
        <!-- STEP 0: INTRO -->
        <section id="step-0" class="glass-panel p-10 rounded-2xl max-w-2xl text-center animate-fade-in">
            <div class="mb-6 inline-flex items-center justify-center w-20 h-20 rounded-full bg-science-50 text-science-600 ring-4 ring-science-100">
                <i class="fas fa-flask text-3xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Estrés Oxidativo (MDA) y Proteínas</h1>
            <p class="text-sm text-science-600 font-mono mb-6 bg-science-50 inline-block px-3 py-1 rounded-full">Modelo Porcino · TBARS · Bradford</p>
            <p class="text-slate-600 mb-8 leading-relaxed text-sm md:text-base">
                Simulación del protocolo completo para la cuantificación de peroxidación lipídica normalizada por concentración de proteína. 
                <br><br>
                <strong>Etapas Críticas:</strong> Homogeneización, Fraccionamiento celular (Centrífuga), Reacción TBARS y Método Bradford.
            </p>
            <button onclick="goToStep(1)" class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition hover:-translate-y-1">
                Comenzar Protocolo <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </section>

        <!-- STEP 1: MUESTREO -->
        <section id="step-1" class="hidden w-full max-w-4xl animate-fade-in">
            <div class="glass-panel p-8 rounded-2xl">
                <div class="flex items-center gap-3 mb-6 border-b pb-4">
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold">1</div>
                    <h3 class="text-xl font-bold text-slate-800">Muestreo y Población</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Population Viz -->
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="font-semibold mb-4 text-xs uppercase text-slate-400 tracking-wider">Sujetos (n=19)</h4>
                        <div class="grid grid-cols-5 gap-4 text-2xl text-slate-300" id="pigs-container"></div>
                        <div class="mt-6 flex justify-between text-xs text-slate-500 font-mono bg-slate-50 p-2 rounded">
                            <span><i class="fas fa-mars text-blue-400"></i> 10 Machos</span>
                            <span><i class="fas fa-venus text-pink-400"></i> 9 Hembras</span>
                            <span class="text-slate-300">|</span>
                            <span>10 Adultos</span>
                            <span>9 Jóvenes</span>
                        </div>
                    </div>

                    <!-- Organ Selection -->
                    <div class="flex flex-col justify-center space-y-4">
                        <p class="text-sm text-slate-500 mb-2">Seleccione los tejidos proporcionados por la Unidad de Anatomía Patológica:</p>
                        
                        <div id="organ-liver" onclick="selectOrgan('liver')" class="cursor-pointer border-2 border-slate-200 rounded-xl p-4 flex items-center hover:border-science-500 hover:bg-science-50 transition group bg-white">
                            <div class="w-10 h-10 bg-red-100 text-red-500 rounded-full flex items-center justify-center mr-4 group-hover:bg-science-500 group-hover:text-white transition">
                                <i class="fas fa-dna"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-700 text-sm">Hígado</h4>
                                <p class="text-xs text-slate-400">Homogeneizado 1/10</p>
                            </div>
                            <i class="fas fa-check-circle ml-auto text-transparent group-[.selected]:text-science-600 transition"></i>
                        </div>

                        <div id="organ-kidney" onclick="selectOrgan('kidney')" class="cursor-pointer border-2 border-slate-200 rounded-xl p-4 flex items-center hover:border-science-500 hover:bg-science-50 transition group bg-white">
                            <div class="w-10 h-10 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center mr-4 group-hover:bg-science-500 group-hover:text-white transition">
                                <i class="fas fa-filter"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-700 text-sm">Riñón</h4>
                                <p class="text-xs text-slate-400">Homogeneizado 1/10</p>
                            </div>
                            <i class="fas fa-check-circle ml-auto text-transparent group-[.selected]:text-science-600 transition"></i>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 flex justify-end">
                    <button id="btn-step-1" disabled onclick="goToStep(2)" class="opacity-50 cursor-not-allowed bg-science-600 text-white font-bold py-2 px-6 rounded-lg transition-all shadow-md hover:shadow-lg">
                        Confirmar y Procesar
                    </button>
                </div>
            </div>
        </section>

        <!-- STEP 2: HOMOGENEIZACIÓN -->
        <section id="step-2" class="hidden w-full max-w-lg animate-fade-in">
            <div class="glass-panel p-8 rounded-2xl text-center">
                <div class="flex items-center gap-3 mb-6 justify-center">
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold">2</div>
                    <h3 class="text-xl font-bold text-slate-800">Homogeneización</h3>
                </div>
                
                <div class="relative h-64 w-24 mx-auto border-4 border-slate-200 rounded-b-3xl bg-white overflow-hidden mb-6 shadow-inner" id="test-tube">
                    <div class="absolute top-2 right-2 text-[10px] text-slate-400">1:10 w/v</div>
                    <div id="tube-liquid" class="liquid absolute bottom-0 w-full bg-red-800 h-12 opacity-90 flex items-center justify-center text-white text-[10px]">
                        Tejido
                    </div>
                </div>

                <div class="flex flex-col space-y-3">
                    <button id="btn-pipette" onclick="addBuffer()" class="bg-teal-600 hover:bg-teal-700 text-white py-3 rounded-lg shadow transition flex items-center justify-center gap-2">
                        <i class="fas fa-eye-dropper"></i> Añadir Tampón Fosfato (pH 7.2)
                    </button>
                    <button id="btn-homogenize" disabled onclick="homogenize()" class="bg-slate-300 text-white py-3 rounded-lg shadow transition disabled:opacity-50 flex items-center justify-center gap-2">
                        <i class="fas fa-blender"></i> Homogeneizar Muestra
                    </button>
                </div>
                <p id="step2-status" class="mt-4 text-xs text-slate-400 font-mono h-5"></p>
            </div>
        </section>

        <!-- STEP 3 & 4: CENTRIFUGA -->
        <section id="step-centrifuge" class="hidden w-full max-w-3xl animate-fade-in">
            <div class="glass-panel p-0 rounded-2xl overflow-hidden flex flex-col md:flex-row shadow-2xl">
                <!-- Visual Left -->
                <div class="bg-slate-800 p-8 flex flex-col items-center justify-center md:w-5/12 text-white relative border-r border-slate-700">
                    <div class="absolute top-4 left-4 text-[10px] text-slate-500 tracking-widest">EPPENDORF 5424R</div>
                    <div id="rotor" class="w-40 h-40 border-[10px] border-slate-700 rounded-full flex items-center justify-center bg-slate-600 relative mb-6 shadow-[inset_0_0_30px_rgba(0,0,0,0.8)]">
                        <!-- Rotor holes -->
                        <div class="absolute w-full h-full animate-[spin_10s_linear_infinite] opacity-30">
                            <div class="w-3 h-3 bg-black rounded-full absolute top-2 left-1/2 -translate-x-1/2"></div>
                            <div class="w-3 h-3 bg-black rounded-full absolute bottom-2 left-1/2 -translate-x-1/2"></div>
                            <div class="w-3 h-3 bg-black rounded-full absolute top-1/2 left-2 -translate-y-1/2"></div>
                            <div class="w-3 h-3 bg-black rounded-full absolute top-1/2 right-2 -translate-y-1/2"></div>
                        </div>
                        <div class="w-12 h-12 bg-slate-400 rounded-full z-10 shadow-lg flex items-center justify-center border-4 border-slate-500">
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                    <div id="centrifuge-status" class="text-xs font-mono text-emerald-400 bg-emerald-900/30 px-3 py-1 rounded">STANDBY</div>
                </div>

                <!-- Controls Right -->
                <div class="p-8 md:w-7/12 bg-white flex flex-col justify-center">
                    <h3 class="text-lg font-bold text-slate-800 mb-2">Configuración Centrífuga</h3>
                    <div class="mb-6 bg-science-50 border-l-4 border-science-500 p-3 text-sm text-science-800 rounded-r">
                        <span id="centrifuge-instruction" class="block">Instrucción actual...</span>
                    </div>

                    <!-- Inputs -->
                    <div class="space-y-5">
                        <div>
                            <label class="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                                <span>Velocidad</span>
                                <span id="rpm-val" class="text-science-600 font-mono">0 rpm</span>
                            </label>
                            <input type="range" id="rpm-slider" min="0" max="14000" step="100" value="0" oninput="updateDisplay()" class="w-full">
                        </div>

                        <div>
                            <label class="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                                <span>Tiempo</span>
                                <span id="time-val" class="text-science-600 font-mono">0 min</span>
                            </label>
                            <input type="range" id="time-slider" min="0" max="30" step="1" value="0" oninput="updateDisplay()" class="w-full">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Temperatura</label>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="setTemp(4)" id="btn-temp-4" class="py-2 border border-slate-200 rounded hover:bg-slate-50 font-mono text-sm transition">4ºC</button>
                                <button onclick="setTemp(25)" id="btn-temp-25" class="py-2 border border-slate-200 rounded hover:bg-slate-50 font-mono text-sm transition">25ºC</button>
                            </div>
                        </div>
                    </div>

                    <!-- Action -->
                    <div class="mt-8">
                        <button onclick="validateCentrifuge()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 rounded-lg shadow-lg transition flex justify-center items-center text-sm">
                            <span id="btn-spin-text">INICIAR CICLO</span>
                        </button>
                        <p id="error-msg" class="text-red-500 text-xs mt-3 text-center h-4 font-semibold"></p>
                    </div>
                </div>
            </div>
            
            <!-- Interstitial Step: Acid Addition -->
            <div id="acid-addition-panel" class="hidden mt-4 glass-panel p-6 rounded-xl flex-col md:flex-row justify-between items-center animate-pulse border-l-4 border-yellow-400">
                <div class="mb-4 md:mb-0">
                    <span class="font-bold text-slate-700 block">Precipitación de Proteínas</span>
                    <span class="text-xs text-slate-500">Necesario para limpiar el sobrenadante antes de MDA</span>
                </div>
                <button onclick="addAcid()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg shadow font-bold text-sm">
                    <i class="fas fa-flask mr-2"></i> + Ácido Perclórico 70%
                </button>
            </div>
        </section>

        <!-- STEP 5: REACCIÓN COLORIMÉTRICA MDA -->
        <section id="step-5" class="hidden w-full max-w-4xl animate-fade-in">
            <div class="glass-panel p-8 rounded-2xl">
                <div class="flex items-center gap-3 mb-6 border-b pb-4">
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold">4</div>
                    <h3 class="text-xl font-bold text-slate-800">Reacción TBARS (MDA)</h3>
                </div>
                
                <div class="flex flex-col md:flex-row gap-8 items-start">
                    <!-- Workbench -->
                    <div class="w-full md:w-1/2 grid grid-cols-1 gap-3">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-1">Reactivos</p>
                        <button onclick="addToReaction('sample')" id="btn-add-sample" class="p-3 border border-slate-200 rounded hover:bg-science-50 transition text-left flex items-center group bg-white">
                            <div class="w-8 h-8 bg-slate-100 rounded flex items-center justify-center mr-3 group-hover:bg-science-500 group-hover:text-white"><i class="fas fa-vial"></i></div>
                            <span class="text-sm font-medium text-slate-600">Sobrenadante (Muestra)</span>
                        </button>
                        <button onclick="addToReaction('tca')" id="btn-add-tca" class="p-3 border border-slate-200 rounded hover:bg-purple-50 transition text-left flex items-center group bg-white">
                            <div class="w-8 h-8 bg-slate-100 rounded flex items-center justify-center mr-3 group-hover:bg-purple-500 group-hover:text-white"><i class="fas fa-fill-drip"></i></div>
                            <span class="text-sm font-medium text-slate-600">TCA 20% (125 µl)</span>
                        </button>
                        <button onclick="addToReaction('tba')" id="btn-add-tba" class="p-3 border border-slate-200 rounded hover:bg-pink-50 transition text-left flex items-center group bg-white">
                            <div class="w-8 h-8 bg-slate-100 rounded flex items-center justify-center mr-3 group-hover:bg-pink-500 group-hover:text-white"><i class="fas fa-tint"></i></div>
                            <span class="text-sm font-medium text-slate-600">TBA 0.67% (250 µl)</span>
                        </button>
                    </div>

                    <!-- Incubator -->
                    <div class="w-full md:w-1/2 bg-slate-100 p-6 rounded-xl border border-slate-200 relative">
                        <div class="absolute -top-3 right-4 bg-slate-600 text-white text-[10px] uppercase font-bold px-2 py-1 rounded tracking-wider">Incubadora Seca</div>
                        
                        <div class="flex justify-center mb-6 mt-4">
                            <div class="h-40 w-12 border-2 border-slate-300 bg-white rounded-b-2xl relative overflow-hidden shadow-sm">
                                <div id="reaction-liquid" class="liquid absolute bottom-0 w-full bg-transparent h-0"></div>
                            </div>
                        </div>

                        <!-- Heat Control -->
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs font-bold text-slate-500">
                                <span>20ºC</span>
                                <span id="temp-display" class="text-red-500 text-lg font-mono">20ºC</span>
                                <span>90ºC</span>
                            </div>
                            <input type="range" id="heat-slider" min="20" max="90" value="20" oninput="updateHeat(this.value)" class="w-full accent-red-500">
                        </div>
                        
                        <div id="timer-display" class="mt-4 text-center font-mono text-xl text-slate-300 bg-slate-800 py-2 rounded">20:00</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- STEP 6: BRADFORD (PROTEÍNAS) - NEW STEP -->
        <section id="step-bradford" class="hidden w-full max-w-4xl animate-fade-in">
            <div class="glass-panel p-8 rounded-2xl">
                <div class="flex items-center gap-3 mb-6 border-b pb-4">
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold">5</div>
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">Cuantificación de Proteínas</h3>
                        <p class="text-xs text-slate-500">Método de Bradford (Estándar: Albúmina Sérica Bovina)</p>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row gap-10 items-center">
                    <!-- Instruction -->
                    <div class="md:w-1/3 space-y-4">
                        <div class="bg-blue-50 border border-blue-100 p-4 rounded-lg">
                            <p class="text-sm text-blue-800 leading-snug">
                                <strong class="block mb-1">Fundamento:</strong>
                                El tinte Coomassie Brilliant Blue G-250 cambia de rojo/marrón a <strong>azul</strong> al unirse a las proteínas.
                            </p>
                        </div>
                        <button onclick="addBradfordReagent()" id="btn-bradford" class="w-full bg-bradford-900 hover:bg-blue-800 text-white font-bold py-3 rounded shadow transition flex items-center justify-center">
                            <i class="fas fa-eye-dropper mr-2"></i> Añadir Reactivo
                        </button>
                    </div>

                    <!-- Microplate Visual -->
                    <div class="md:w-2/3 bg-slate-800 p-6 rounded-xl shadow-inner relative">
                        <span class="text-slate-400 text-xs absolute top-2 left-4">Microplaca 96 pocillos</span>
                        <div class="grid grid-cols-6 gap-3 mt-4">
                            <!-- JS generates wells -->
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                            <div class="well w-8 h-8 rounded-full bg-amber-900/40 border border-slate-600"></div>
                        </div>
                        <div id="bradford-status" class="mt-4 text-center text-xs font-mono text-slate-400 h-4">Esperando reactivo...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- STEP 7: RESULTADOS (Updated) -->
        <section id="step-7" class="hidden w-full max-w-5xl animate-fade-in">
            <div class="glass-panel p-8 rounded-2xl">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                    <div>
                        <h3 class="text-2xl font-bold text-slate-800">Resultados Finales</h3>
                        <p class="text-sm text-slate-500">Datos normalizados (Ratio MDA / Proteína)</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="bg-pink-100 text-pink-700 px-3 py-1 rounded text-xs font-bold">λ=550nm (MDA)</span>
                        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-xs font-bold">λ=595nm (Prot)</span>
                    </div>
                </div>

                <div class="overflow-x-auto rounded-lg border border-slate-200 shadow-sm mb-6">
                    <table class="min-w-full bg-white text-sm">
                        <thead class="bg-slate-50 text-slate-500 uppercase font-bold text-[10px] tracking-wider">
                            <tr>
                                <th class="py-3 px-4 text-left">ID</th>
                                <th class="py-3 px-4 text-left">Grupo</th>
                                <th class="py-3 px-4 text-left">Tejido</th>
                                <th class="py-3 px-4 text-right bg-slate-100">Abs 550</th>
                                <th class="py-3 px-4 text-right bg-slate-100">Abs 595</th>
                                <th class="py-3 px-4 text-right">Proteína (mg/ml)</th>
                                <th class="py-3 px-4 text-right text-science-600 border-l border-slate-100">MDA (nmol/mg prot)</th>
                            </tr>
                        </thead>
                        <tbody id="results-body" class="divide-y divide-slate-100">
                            <!-- JS fills this -->
                        </tbody>
                    </table>
                </div>

                <div class="p-4 bg-amber-50 border border-amber-100 rounded-lg flex items-start gap-3">
                    <i class="fas fa-microscope text-amber-500 mt-1"></i>
                    <div>
                        <h4 class="font-bold text-amber-800 text-sm">Conclusión del Investigador</h4>
                        <p class="text-amber-700 text-xs mt-1 leading-relaxed">
                            Se observa una elevación significativa de los niveles de MDA en el grupo isquémico al normalizar por proteína. 
                            Sin la corrección de Bradford, las variaciones en la cantidad de tejido homogeneizado podrían haber sesgado la interpretación de la peroxidación lipídica.
                        </p>
                    </div>
                </div>
                
                <button onclick="location.reload()" class="mt-8 w-full text-slate-400 hover:text-slate-600 text-xs uppercase font-bold py-2 tracking-widest transition">
                    Reiniciar Experimento
                </button>
            </div>
        </section>

    </main>

    <script>
        // --- STATE & CONFIG ---
        let currentStep = 0;
        const totalSteps = 7;
        let selectedOrgans = [];
        let centrifugeStage = 0; 
        let selectedTemp = null;
        let reactionMix = { sample: false, tca: false, tba: false };

        // Protocols
        // 0: Homogenization Spin (5000g)
        // 1: MDA Specific Prep (3500 rpm)
        // 2: High Speed Clean (12000 rpm)
        // 3: Post-Acid Precipitation (3500 rpm)
        const centrifugeProtocols = [
            { rpm: 5000, time: 3, temp: 4, desc: "Fase 1: Clarificación (5000xg/3min)" },
            { rpm: 3500, time: 5, temp: null, desc: "Fase 2: Preparación MDA (3500rpm/5min)" }, 
            { rpm: 12000, time: 20, temp: 4, desc: "Fase 3: Separación Sobrenadante (12000rpm/20min)" },
            { rpm: 3500, time: 15, temp: 4, desc: "Fase 4: Precipitación post-ácido (3500rpm/15min)" }
        ];

        // --- NAVIGATION ---
        function goToStep(step) {
            // Hide all sections
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            
            // Determine correct section ID
            let sectionId = `step-${step}`;
            if (step === 3 || step === 4) sectionId = 'step-centrifuge';
            if (step === 6) sectionId = 'step-bradford'; // New Step
            if (step === 7) sectionId = 'step-7'; // Results

            document.getElementById(sectionId).classList.remove('hidden');
            
            currentStep = step;
            updateProgressBar();
            
            // Step Init Logic
            if(step === 1) initPigs();
            if(step === 3) setupCentrifugeStage();
            if(step === 7) generateResults();
        }

        function updateProgressBar() {
            const percent = (currentStep / totalSteps) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;
            
            const titles = ["Inicio", "Muestreo", "Homogeneización", "Centrifugado", "Precipitación", "TBARS", "Bradford", "Resultados"];
            document.getElementById('step-counter').innerText = titles[currentStep] || "";
        }

        // --- STEP 1: PIGS ---
        function initPigs() {
            const container = document.getElementById('pigs-container');
            if(container.childElementCount > 0) return;
            
            for(let i=0; i<19; i++) {
                const isMale = i < 10;
                const icon = document.createElement('i');
                icon.className = `fas fa-piggy-bank ${isMale ? 'text-slate-300' : 'text-slate-300'} text-opacity-50 hover:text-science-400 transition transform hover:scale-110 cursor-help`;
                icon.title = isMale ? "Macho" : "Hembra";
                container.appendChild(icon);
            }
        }

        function selectOrgan(organ) {
            const el = document.getElementById(`organ-${organ}`);
            if(selectedOrgans.includes(organ)) {
                selectedOrgans = selectedOrgans.filter(o => o !== organ);
                el.classList.remove('border-science-500', 'bg-science-50', 'selected');
            } else {
                selectedOrgans.push(organ);
                el.classList.add('border-science-500', 'bg-science-50', 'selected');
            }
            const btn = document.getElementById('btn-step-1');
            btn.disabled = selectedOrgans.length === 0;
            if(!btn.disabled) btn.classList.remove('opacity-50', 'cursor-not-allowed');
            else btn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // --- STEP 2: HOMOGENEIZACIÓN ---
        function addBuffer() {
            const liquid = document.getElementById('tube-liquid');
            liquid.style.height = '60%';
            liquid.style.backgroundColor = '#991b1b';
            liquid.innerHTML = "Mix";
            
            document.getElementById('btn-pipette').disabled = true;
            document.getElementById('btn-pipette').classList.add('opacity-50');
            
            const btnH = document.getElementById('btn-homogenize');
            btnH.disabled = false;
            btnH.classList.replace('bg-slate-300', 'bg-science-600');
            btnH.classList.add('hover:bg-science-700');
        }

        function homogenize() {
            const tube = document.getElementById('test-tube');
            tube.classList.add('animate-vibrate');
            document.getElementById('step2-status').innerText = "Homogeneizando a 5000 rpm...";
            
            setTimeout(() => {
                tube.classList.remove('animate-vibrate');
                document.getElementById('tube-liquid').style.backgroundColor = '#fca5a5';
                document.getElementById('tube-liquid').innerHTML = "Ready";
                document.getElementById('step2-status').innerText = "Completado.";
                setTimeout(() => goToStep(3), 800);
            }, 2000);
        }

        // --- CENTRIFUGA (CORE) ---
        function setupCentrifugeStage() {
            const protocol = centrifugeProtocols[centrifugeStage];
            document.getElementById('centrifuge-instruction').innerText = protocol.desc;
            
            document.getElementById('rpm-slider').value = 0;
            document.getElementById('time-slider').value = 0;
            updateDisplay();
            setTemp(null);
            document.getElementById('error-msg').innerText = "";
            document.getElementById('rotor').children[0].style.animationPlayState = 'paused';
            document.getElementById('centrifuge-status').innerText = "STANDBY";
            document.getElementById('centrifuge-status').className = "text-xs font-mono text-emerald-400 bg-emerald-900/30 px-3 py-1 rounded";
            document.getElementById('rpm-slider').disabled = false;
        }

        function updateDisplay() {
            document.getElementById('rpm-val').innerText = document.getElementById('rpm-slider').value + " rpm";
            document.getElementById('time-val').innerText = document.getElementById('time-slider').value + " min";
        }

        function setTemp(t) {
            selectedTemp = t;
            document.getElementById('btn-temp-4').classList.remove('bg-science-50', 'border-science-500', 'text-science-600');
            document.getElementById('btn-temp-25').classList.remove('bg-science-50', 'border-science-500', 'text-science-600');
            
            if(t === 4) document.getElementById('btn-temp-4').classList.add('bg-science-50', 'border-science-500', 'text-science-600');
            if(t === 25) document.getElementById('btn-temp-25').classList.add('bg-science-50', 'border-science-500', 'text-science-600');
        }

        function validateCentrifuge() {
            const currentRpm = parseInt(document.getElementById('rpm-slider').value);
            const currentTime = parseInt(document.getElementById('time-slider').value);
            const target = centrifugeProtocols[centrifugeStage];
            const errorEl = document.getElementById('error-msg');

            if(Math.abs(currentRpm - target.rpm) > 500) { // More lenient
                errorEl.innerText = `Error: Ajuste velocidad a ${target.rpm} rpm`;
                return;
            }
            if(currentTime !== target.time) {
                errorEl.innerText = `Error: Tiempo debe ser ${target.time} min`;
                return;
            }
            if(target.temp !== null && selectedTemp !== target.temp) {
                errorEl.innerText = `Error: Temperatura incorrecta`;
                return;
            }

            errorEl.innerText = "";
            // Animation
            document.getElementById('rotor').children[0].style.animationPlayState = 'running';
            document.getElementById('centrifuge-status').innerText = "RUNNING";
            document.getElementById('centrifuge-status').className = "text-xs font-mono text-red-500 bg-red-900/20 px-3 py-1 rounded animate-pulse";

            setTimeout(() => {
                document.getElementById('rotor').children[0].style.animationPlayState = 'paused';
                document.getElementById('centrifuge-status').innerText = "DONE";
                document.getElementById('centrifuge-status').className = "text-xs font-mono text-science-500 bg-science-100 px-3 py-1 rounded";
                nextCentrifugeStage();
            }, 2000);
        }

        function nextCentrifugeStage() {
            centrifugeStage++;
            
            if(centrifugeStage === 1 || centrifugeStage === 2) {
                setupCentrifugeStage();
            } else if (centrifugeStage === 3) {
                // Post-Acid Checkpoint
                document.getElementById('centrifuge-instruction').innerText = "Ciclo finalizado. Requiere precipitación proteica.";
                document.getElementById('rpm-slider').disabled = true;
                document.getElementById('acid-addition-panel').classList.remove('hidden');
                document.getElementById('acid-addition-panel').classList.add('flex');
            } else {
                // Done
                goToStep(5);
            }
        }

        function addAcid() {
            document.getElementById('acid-addition-panel').classList.add('hidden');
            setupCentrifugeStage(); // Start stage 3 (protocol index 3)
        }

        // --- STEP 5: MDA REACTION ---
        function addToReaction(component) {
            reactionMix[component] = true;
            const btn = document.getElementById(`btn-add-${component}`);
            btn.classList.add('border-green-500', 'bg-green-50');
            btn.innerHTML = `<div class="w-8 h-8 bg-green-100 rounded flex items-center justify-center mr-3"><i class="fas fa-check text-green-600"></i></div><span class="text-xs text-green-700 font-bold">Añadido</span>`;
            
            let height = 0;
            if(reactionMix.sample) height += 20;
            if(reactionMix.tca) height += 30;
            if(reactionMix.tba) height += 40;
            
            const liq = document.getElementById('reaction-liquid');
            liq.style.height = `${height}%`;
            liq.style.backgroundColor = '#f1f5f9';
        }

        function updateHeat(val) {
            document.getElementById('temp-display').innerText = val + 'ºC';
            if(val >= 80 && reactionMix.sample && reactionMix.tca && reactionMix.tba) {
                startIncubation();
            }
        }

        let incubating = false;
        function startIncubation() {
            if(incubating) return;
            incubating = true;
            document.getElementById('heat-slider').disabled = true;
            document.getElementById('timer-display').classList.add('text-red-400');
            
            let timeLeft = 20;
            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-display').innerText = `${timeLeft}:00`;
                
                if(timeLeft < 10) document.getElementById('reaction-liquid').style.backgroundColor = '#f9a8d4';
                if(timeLeft < 5) document.getElementById('reaction-liquid').style.backgroundColor = '#db2777'; // Pink

                if(timeLeft <= 0) {
                    clearInterval(timer);
                    document.getElementById('timer-display').innerText = "FIN";
                    setTimeout(() => goToStep(6), 1000); // Go to Bradford now
                }
            }, 100);
        }

        // --- STEP 6: BRADFORD (Logic) ---
        function addBradfordReagent() {
            const wells = document.querySelectorAll('.well');
            document.getElementById('btn-bradford').disabled = true;
            document.getElementById('btn-bradford').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Incubando...';
            document.getElementById('bradford-status').innerText = "Reaccionando (Coomassie binding)...";

            wells.forEach((well, index) => {
                setTimeout(() => {
                    // Random shades of blue for realism
                    const blueIntensity = 500 + (Math.floor(Math.random() * 4) * 100); 
                    well.style.backgroundColor = '#1d4ed8'; // standard blue
                    well.style.opacity = 0.5 + (Math.random() * 0.5);
                }, index * 50);
            });

            setTimeout(() => {
                document.getElementById('bradford-status').innerText = "Lectura completada a 595 nm.";
                document.getElementById('btn-bradford').innerHTML = '<i class="fas fa-check mr-2"></i> Completado';
                document.getElementById('btn-bradford').classList.replace('bg-bradford-900', 'bg-green-600');
                
                setTimeout(() => goToStep(7), 1500);
            }, 2000);
        }

        // --- STEP 7: RESULTS ---
        function generateResults() {
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '';
            
            for(let i=1; i<=8; i++) { // Generate 8 sample rows
                const isIschemia = i > 4;
                
                // Calculations sim
                // High stress = High MDA
                const rawMda = isIschemia ? (Math.random() * 0.8 + 0.5) : (Math.random() * 0.3 + 0.1);
                
                // Protein variation (some samples have more tissue)
                const protein = (Math.random() * 5 + 10).toFixed(1); // 10-15 mg/ml
                
                // The Ratio
                const finalRatio = ((rawMda * 100) / protein).toFixed(2); // Simplified math for demo
                const abs550 = rawMda.toFixed(3);
                const abs595 = (protein / 20).toFixed(3); // Mock abs for protein

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="py-3 px-4 text-slate-500 font-mono text-xs">S-${String(i).padStart(2,'0')}</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 rounded-full text-[10px] uppercase font-bold ${isIschemia ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}">${isIschemia ? 'Lesión' : 'Control'}</span></td>
                    <td class="py-3 px-4 text-slate-500 text-xs">${i%2===0 ? 'Riñón' : 'Hígado'}</td>
                    <td class="py-3 px-4 text-right font-mono text-slate-400 text-xs bg-slate-50">${abs550}</td>
                    <td class="py-3 px-4 text-right font-mono text-slate-400 text-xs bg-slate-50">${abs595}</td>
                    <td class="py-3 px-4 text-right font-mono text-slate-600 text-xs">${protein}</td>
                    <td class="py-3 px-4 text-right font-bold text-science-600 border-l border-slate-100">${finalRatio}</td>
                `;
                tbody.appendChild(tr);
            }
        }
    </script>
</body>
</html>